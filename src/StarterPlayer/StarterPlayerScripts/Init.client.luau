--!strict
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local controllersFolder = script.Parent:WaitForChild("Controllers") -- ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏°‡πà

print("üîå Client Init: Starting Controllers...")

local controllers = {}

-- Production mode: Skip demo/test controllers
local SKIP_IN_PRODUCTION = {
    ["DemoController"] = true,
    ["TestController"] = true,
}

local IS_PRODUCTION = false -- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏°‡∏∑‡πà‡∏≠ deploy

-- Step 1: Load and Init all controllers
print("[Client Init] Step 1: Initializing controllers...")
for _, moduleScript in ipairs(controllersFolder:GetChildren()) do
    if moduleScript:IsA("ModuleScript") then
        -- Skip demo/test controllers in production
        if IS_PRODUCTION and SKIP_IN_PRODUCTION[moduleScript.Name] then
            print(`[Client Init] ‚è≠Ô∏è Skipped {moduleScript.Name} (Production mode)`)
            continue
        end
        
        local success, result = pcall(function()
            return require(moduleScript)
        end)
        
        if success then
            controllers[moduleScript.Name] = result
            print(`[Client Init] ‚úÖ Loaded {moduleScript.Name}`)
            
            -- Init phase
            if type(result.Init) == "function" then
                local initSuccess, initErr = pcall(function()
                    result:Init()
                end)
                
                if not initSuccess then
                    warn(`‚ùå Failed to init {moduleScript.Name}: {initErr}`)
                end
            end
        else
            warn(`‚ùå Failed to load {moduleScript.Name}: {result}`)
        end
    end
end

-- Step 2: Start all controllers
print("[Client Init] Step 2: Starting controllers...")
for name, controller in pairs(controllers) do
    if type(controller.Start) == "function" then
        task.spawn(function()
            local success, err = pcall(function()
                controller:Start()
            end)
            
            if success then
                print(`[Client Init] ‚úÖ Started {name}`)
            else
                warn(`‚ùå Failed to start {name}: {err}`)
            end
        end)
    end
end

print("‚úÖ All controllers initialized and started.")

-- Expose for debugging (only in development)
if not IS_PRODUCTION then
    _G.Controllers = controllers
    _G.DemoController = controllers.DemoController
    _G.TestController = controllers.TestController
end



