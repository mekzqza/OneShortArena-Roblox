--!strict
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local controllersFolder = script.Parent:WaitForChild("Controllers") -- ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏°‡πà

print("üîå Client Init: Starting Controllers...")

local controllers = {}

-- Step 1: Load and Init all controllers
print("[Client Init] Step 1: Initializing controllers...")
for _, moduleScript in ipairs(controllersFolder:GetChildren()) do
    if moduleScript:IsA("ModuleScript") then
        local success, result = pcall(function()
            return require(moduleScript)
        end)
        
        if success then
            controllers[moduleScript.Name] = result
            print(`[Client Init] ‚úÖ Loaded {moduleScript.Name}`)
            
            -- Init phase
            if type(result.Init) == "function" then
                local initSuccess, initErr = pcall(function()
                    result:Init()
                end)
                
                if not initSuccess then
                    warn(`‚ùå Failed to init {moduleScript.Name}: {initErr}`)
                end
            end
        else
            warn(`‚ùå Failed to load {moduleScript.Name}: {result}`)
        end
    end
end

-- Step 2: Start all controllers
print("[Client Init] Step 2: Starting controllers...")
for name, controller in pairs(controllers) do
    if type(controller.Start) == "function" then
        task.spawn(function()
            local success, err = pcall(function()
                controller:Start()
            end)
            
            if success then
                print(`[Client Init] ‚úÖ Started {name}`)
            else
                warn(`‚ùå Failed to start {name}: {err}`)
            end
        end)
    end
end

print("‚úÖ All controllers initialized and started.")



