--!strict

-- à¹„à¸Ÿà¸¥à¹Œà¸™à¸µà¹‰à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸š server-side services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ServerScriptService = game:GetService("ServerScriptService")

local Events = require(ReplicatedStorage.Shared.Events)
local IdempotentGuard = require(ServerScriptService.Utils.IdempotentGuard)
local ServiceLocator = require(ServerScriptService.Utils.ServiceLocator)

export type TestService = {
    Init: (self: TestService) -> (),
    Start: (self: TestService) -> (),
    [string]: any,
}

local TestService = {} :: TestService

local guard = IdempotentGuard.new("TestService", true)

function TestService:Init()
	if not guard:MarkInitialized() then
		return
	end
	
	print("[TestService] ğŸ”§ Initializing...")
	print("[TestService] âœ… Initialized")
end

function TestService:Start()
	if not guard:MarkStarted() then
		return
	end
	
	print("[TestService] ğŸš€ Starting...")
	
	-- Get NetworkHandler
	local NetworkHandler = ServiceLocator:Get("NetworkHandler")
	
	if NetworkHandler then
		-- âœ… FIX: Return (success: boolean, response: any?)
		NetworkHandler:RegisterRequestHandler(Events.TEST_PING, function(player: Player, data: any)
			print(`[TestService-server] âœ… Received TEST_PING from {player.Name} with data:`, data)
			
			-- âœ… Return tuple: (true, data)
			return true, {
				message = "PONG from server!",
				receivedData = data,
			}
		end)
		
		print("[TestService] ğŸ“¡ Registered TEST_PING handler")
	else
		warn("[TestService] âš ï¸ NetworkHandler not available!")
	end
	
	print("[TestService] âœ… Started")
end

return TestService

