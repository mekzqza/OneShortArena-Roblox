# üîÑ State Transition Rules - ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ Log

## üìä Log ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô

```
15:16:59 -- [PlayerStateService] ‚ùå sukpatzqza cannot join Arena: Cannot transition from Died to Arena
15:16:59 -- [PlayerStateController] ‚ùå State change failed: Cannot transition from Died to Arena
```

---

## ‚úÖ ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏Å‡∏ï‡∏¥! (Working as Designed)

### ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   üìñ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  1. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Arena                                          ‚îÇ
‚îÇ     ‚îÇ                                                           ‚îÇ
‚îÇ     ‚ñº                                                           ‚îÇ
‚îÇ  2. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ä‡∏ô Trap Part ‚Üí ‡∏ï‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Health = 0)                ‚îÇ
‚îÇ     ‚îÇ                                                           ‚îÇ
‚îÇ     ‚ñº                                                           ‚îÇ
‚îÇ  3. DeathService ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ:                                        ‚îÇ
‚îÇ     ‚Ä¢ Humanoid.Died event fires                                ‚îÇ
‚îÇ     ‚Ä¢ DeathService:HandleDeath()                               ‚îÇ
‚îÇ     ‚Ä¢ EventBus:Emit(PLAYER_DIED)                               ‚îÇ
‚îÇ     ‚îÇ                                                           ‚îÇ
‚îÇ     ‚ñº                                                           ‚îÇ
‚îÇ  4. PlayerStateService ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö PLAYER_DIED:                      ‚îÇ
‚îÇ     ‚Ä¢ SetState(player, "Died") ‚úÖ                               ‚îÇ
‚îÇ     ‚Ä¢ currentState = "Died"                                    ‚îÇ
‚îÇ     ‚îÇ                                                           ‚îÇ
‚îÇ     ‚ñº                                                           ‚îÇ
‚îÇ  5. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏¢‡∏±‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Play" ‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà (‡∏´‡∏£‡∏∑‡∏≠ network lag):         ‚îÇ
‚îÇ     ‚Ä¢ ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏Å‡πà‡∏≤ PLAYER_REQUEST_TO_ARENA ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á server            ‚îÇ
‚îÇ     ‚îÇ                                                           ‚îÇ
‚îÇ     ‚ñº                                                           ‚îÇ
‚îÇ  6. PlayerStateService ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° SetState("Arena"):                ‚îÇ
‚îÇ     ‚Ä¢ currentState = "Died" ‚ùå                                  ‚îÇ
‚îÇ     ‚Ä¢ newState = "Arena"                                       ‚îÇ
‚îÇ     ‚Ä¢ ‚ùå ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô! (Invalid transition)                     ‚îÇ
‚îÇ     ‚îÇ                                                           ‚îÇ
‚îÇ     ‚ñº                                                           ‚îÇ
‚îÇ  7. Log: "Cannot transition from Died to Arena" ‚úÖ              ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ State Transition Rules (‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô State)

### Valid Transitions (‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               ‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô State ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  Lobby ‚Üí Arena        ‚úÖ "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏î Play"                        ‚îÇ
‚îÇ  Lobby ‚Üí Spectating   ‚úÖ "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π"                        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Arena ‚Üí Died         ‚úÖ "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏¢‡πÉ‡∏ô Arena"                   ‚îÇ
‚îÇ  Arena ‚Üí Lobby        ‚úÖ "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏•‡∏±‡∏ö Lobby"                     ‚îÇ
‚îÇ  Arena ‚Üí Spectating   ‚úÖ "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π"                        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Died ‚Üí Lobby         ‚úÖ "Respawn ‡πÑ‡∏õ Lobby"                      ‚îÇ
‚îÇ  Died ‚Üí Spectating    ‚úÖ "‡∏î‡∏π‡∏ï‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô respawn"                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Spectating ‚Üí Lobby   ‚úÖ "‡∏Å‡∏•‡∏±‡∏ö Lobby"                            ‚îÇ
‚îÇ  Spectating ‚Üí Arena   ‚úÖ "‡πÄ‡∏Ç‡πâ‡∏≤ Arena"                            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### Invalid Transitions (‡∏´‡πâ‡∏≤‡∏°)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               ‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô State ‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏°                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  Died ‚Üí Arena         ‚ùå "‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡∏ï‡∏£‡∏á‡πÜ!"           ‚îÇ
‚îÇ                       ‚îî‚îÄ ‡∏ï‡πâ‡∏≠‡∏á respawn ‡∏ó‡∏µ‡πà Lobby ‡∏Å‡πà‡∏≠‡∏ô            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Died ‚Üí Died          ‚ùå "‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏¢‡∏ã‡πâ‡∏≥"                      ‚îÇ
‚îÇ                       ‚îî‚îÄ (‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡πá idempotent)              ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Arena ‚Üí Arena        ‚ö†Ô∏è "Idempotent - ‡πÑ‡∏°‡πà error ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£" ‚îÇ
‚îÇ                       ‚îî‚îÄ (‡∏î‡∏π Log-Behavior-Explanation.md)      ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Log ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

### Log Sequence:

```
15:16:34 -- [ArenaService] sukpatzqza state changed to Arena, spawning...
15:16:34 -- [ArenaService] ‚úÖ sukpatzqza spawned in Arena
```
**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

---

```
15:16:44 -- [DeathService] üíÄ sukpatzqza died (Unknown)
```
**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏¢ (‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: Unknown = ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Combat)  
**‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô:** ‡∏ä‡∏ô Trap Part ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á!

---

```
15:16:44 -- [PlayerStateService] ‚úÖ sukpatzqza marked as Died
```
**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:** State ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "Died" ‡πÅ‡∏•‡πâ‡∏ß

---

```
15:16:59 -- [InputHandler] ‚ñ∂Ô∏è Play button pressed
15:16:59 -- [PlayerStateService] ‚ùå sukpatzqza cannot join Arena: Cannot transition from Died to Arena
```
**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢:** ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Play ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á "Died" ‡∏≠‡∏¢‡∏π‡πà  
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‚ùå ‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Died ‚Üí Arena)

---

## ‚úÖ ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πâ‡∏≤‡∏° Died ‚Üí Arena?

### ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• 1: Game Logic

```
‚ùå ‡∏ñ‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Died ‚Üí Arena:

‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏¢ ‚Üí ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Play ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ respawn delay
‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ penalty ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏¢
‚Üí ‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•!
```

```
‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Died ‚Üí Lobby ‚Üí Arena:

‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏¢ ‚Üí ‡∏£‡∏≠ respawn ‚Üí ‡πÑ‡∏õ Lobby ‚Üí ‡∏Å‡∏î Play ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤ Arena
‚Üí ‡∏°‡∏µ respawn delay (3-10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
‚Üí ‡∏°‡∏µ penalty
‚Üí ‡πÄ‡∏Å‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•!
```

---

### ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• 2: Prevent Exploits

```
‚ùå ‡∏ñ‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï:
Hacker ‡∏≠‡∏≤‡∏à bypass respawn system
‚Üí ‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
‚Üí ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢ kill streak
‚Üí ‡πÇ‡∏Å‡∏á!

‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ú‡πà‡∏≤‡∏ô Lobby:
‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏¢ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô Lobby
‚Üí reset state
‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏Å‡∏á
```

---

### ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• 3: User Experience

```
‚úÖ Flow ‡∏ó‡∏µ‡πà‡∏î‡∏µ:
Died ‚Üí Lobby (‡∏î‡∏π scoreboard, ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å loadout)
     ‚Üí ‡∏Å‡∏î Play ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
     ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤ Arena

‚ùå Flow ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡πà:
Died ‚Üí Arena (‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
     ‚Üí ‡∏™‡∏±‡∏ö‡∏™‡∏ô! ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß
```

---

## üõ†Ô∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡πÑ‡∏î‡πâ)

### Option 1: Respawn to Lobby First (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

‡πÉ‡∏ô **PlayerStateService**:

```lua
-- Listen for PLAYER_RESPAWN_REQUESTED
EventBus:On(Events.PLAYER_RESPAWN_REQUESTED, function(player, respawnData)
    -- ‚úÖ Force respawn to Lobby first
    local success = self:SetState(player, "Lobby", "Respawn after death")
    
    if success then
        print(`[PlayerStateService] ‚úÖ {player.Name} respawned to Lobby`)
    end
end)
```

‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞:
1. ‡∏ï‡∏≤‡∏¢ ‚Üí State = "Died"
2. ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
3. Respawn ‚Üí State = "Lobby" (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
4. ‡∏Å‡∏î Play ‚Üí State = "Arena" ‚úÖ

---

### Option 2: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Died ‚Üí Arena (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

‡πÅ‡∏Å‡πâ **PlayerStateService**:

```lua
-- filepath: PlayerStateService.luau

local VALID_TRANSITIONS = {
    -- ...existing transitions...
    
    -- ‚ö†Ô∏è ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Died ‚Üí Arena (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥!)
    Died = {"Lobby", "Spectating", "Arena"}, -- ‡πÄ‡∏û‡∏¥‡πà‡∏° "Arena"
}
```

‚ö†Ô∏è **‡∏ú‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á:**
- ‡πÑ‡∏°‡πà‡∏°‡∏µ respawn delay
- ‡πÑ‡∏°‡πà‡∏°‡∏µ penalty
- ‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•
- ‡∏≠‡∏≤‡∏à‡∏°‡∏µ exploit

---

## üìä ‡∏™‡∏£‡∏∏‡∏õ: Log ‡∏ô‡∏µ‡πâ‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏´‡∏°?

| Aspect | Status | ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------|--------|
| **"Cannot transition from Died to Arena"** | ‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥ | ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏¢ |
| **State transition blocked** | ‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥ | Validation rules ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á |
| **‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Trap** | ‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥ | Trap Part ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á |
| **‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç** | ‚ùå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á | ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ feature ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà bug! |

---

## üéì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: Trap Part

### Trap Part ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á?

```lua
local trapPart = script.Parent :: BasePart

local function onTouched(otherPart: BasePart)
    local character = otherPart.Parent
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid") :: Humanoid?
    
    if humanoid and humanoid.Health > 0 then
        humanoid.Health = 0  -- ‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ï‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
    end
end

trapPart.Touched:Connect(onTouched)
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
1. `humanoid.Health = 0` ‚Üí `Humanoid.Died` fires
2. DeathService ‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ ‚Üí `HandleDeath()`
3. `EventBus:Emit(PLAYER_DIED)`
4. PlayerStateService ‚Üí `SetState("Died")`
5. ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞ respawn ‡∏ó‡∏µ‡πà Lobby ‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

---

## üí° Recommendations

### ‚úÖ ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥

1. **‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ Transition Rules ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô**
   - Died ‚Üí Arena ‡∏Ñ‡∏ß‡∏£‡∏´‡πâ‡∏≤‡∏°
   - Force respawn ‡∏ó‡∏µ‡πà Lobby ‡∏Å‡πà‡∏≠‡∏ô

2. **‡πÄ‡∏û‡∏¥‡πà‡∏° Death UI**
   - ‡πÅ‡∏™‡∏î‡∏á "You Died!" message
   - ‡πÅ‡∏™‡∏î‡∏á kill cam (optional)
   - Countdown timer ‡∏Å‡πà‡∏≠‡∏ô respawn

3. **Track death cause**
   - Unknown ‚Üí Environmental (Trap)
   - ‡πÉ‡∏ô Trap Part ‡πÉ‡∏´‡πâ set:
   ```lua
   humanoid:SetAttribute("DeathByEnvironment", true)
   humanoid.Health = 0
   ```

### ‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥

1. **‚ùå ‡∏≠‡∏¢‡πà‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Died ‚Üí Arena**
   - ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•

2. **‚ùå ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏ö Transition Validation**
   - ‡∏°‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ security feature

3. **‚ùå ‡∏≠‡∏¢‡πà‡∏≤ bypass State System**
   - ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î race condition

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ 1 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ

**Log ‡∏ô‡∏µ‡πâ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤: "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ Arena ‡∏ï‡∏£‡∏á‡πÜ ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á respawn ‡∏ó‡∏µ‡πà Lobby ‡∏Å‡πà‡∏≠‡∏ô - ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!"** ‚úÖ

---

**Version:** 1.0  
**Author:** OneShortArena Team  
**Purpose:** ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ State Transition Rules
